# 요구사항

- 모아보기라는 기능을 리뉴얼 해야합니다. 내가 구독중인 모든 유저의 글을 시간순으로 정렬해서 볼수 있어야해요. 어떻게 시스템을 구성 하시겠습니까?
- 하루에 글이 1000만개씩 올라온다고 가정 한다면?
- 내가 구독하는 유저가 10만명이라면?

# push 모델 vs pull 모델

- push 모델
    - 글이 올라온 시점에 생산자의 구독자들에게 전부 insert하는 방식
    - 장점
        - 피드가 실시간으로 갱신됨
        - 포스팅이 기록되는 순간 피드가 갱신되므로 피드를 읽는데 드는 시간이 짧아짐
    - 단점
        - 한번에 많은 insert가 진행되서 많은 시간 소요
        - 서비스를 자주 사용하지 않는 소비자의 피드에도 insert 시켜줘야 해서 자원 낭비
- pull 모델
    - 구독자들이 피드 읽기 요청을 보낸 시점에 구독 목록의 포스팅을 가져오는 방식
    - 장점
        - 서비스를 자주 사용하지 않는 소비자에게는 insert하지 않음
    - 단점
        - 피드를 읽는데 시간이 오래걸림
- 정리
    - push 모델은 개인별 타임라인 인덱스를 둬서 공간 복잡도를 희생한 모델
    - pull 모델은 읽기 시점에 포스팅 인덱스 전체를 OR 연산으로 검색하므로 시간 복잡도를 희생한 모델
    - 결국 포스팅할 때는 pull 모델이 유리, 피드를 읽을 때는 push 모델이 유리
    - 메시지 큐를 이용해서 피드 저장 요청을 비동기로 처리
    - 캐시에 포스팅 전체 정보가 아닌 ID 정보만 저장해서 메모리 누수 최소화

# 크리에이터

- 포스팅 생산자

# 팔로워

- 포스팅 소비자

# 크리에이터 포스팅 상태 캐시

- 과도한 포스팅을 스팸으로 판단하여 처리율을 제한하기 위한 목적
- 일정 기간동안의 크리에이터의 포스팅 수를 저장

# 포스팅 캐시

- (크리에이터 ID, 포스팅 ID) 저장

# 피드 캐시

- (포스팅 ID, 팔로워 ID) 저장

# 포스팅 저장 프로세스

1. 크리에이터가 포스팅 저장 요청
2. 크리에이터 포스팅 상태 캐시를 참고하여 스팸 요청은 제한
3. 포스팅 캐시에 (크리에이터 ID, 포스트 ID) 저장
4. 포스팅 DB에 포스트 내용 저장

# 포스팅 전송 프로세스

1. 포스팅 저장 정상 완료 후 포스팅 전송 요청
2. 크리에이터별 팔로워 ID 매핑 DB를 참고하여 피드 데이터(포스팅 ID, 팔로워 ID)를 생성하여 메시지 큐에 전송
3. 포스팅 전송 작업 서버에서 메시지 큐의 데이터를 꺼내어 피드 캐시에 피드 데이터를 저장

# 피드 조회 프로세스

1. 피드 캐시에 저장된 피드 데이터(포스팅 ID, 팔로워 ID) 조회
2. 포스팅 캐시에 저장된 (포스트 ID, 크리에이터 ID) 데이터 가져옴
3. 포스트 ID로 포스팅 DB에 저장된 정보 조회
4. 크리에이터 ID로 유저 DB에 저장된 정보 조회
5. 유저 피드 조회 요청에게 응답
